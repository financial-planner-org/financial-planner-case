# Financial Planner - Multi Family Office

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=flat&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Next.js](https://img.shields.io/badge/Next.js-14-000000?style=flat&logo=nextdotjs&logoColor=white)](https://nextjs.org/)
[![Fastify](https://img.shields.io/badge/Fastify-4-202020?style=flat&logo=fastify&logoColor=white)](https://www.fastify.io/)
[![Prisma](https://img.shields.io/badge/Prisma-5-3982CE?style=flat&logo=Prisma&logoColor=white)](https://www.prisma.io/)
[![Node.js](https://img.shields.io/badge/Node.js-20-339933?style=flat&logo=nodedotjs&logoColor=white)](https://nodejs.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-4169E1?style=flat&logo=postgresql&logoColor=white)](https://www.postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-2496ED?style=flat&logo=docker&logoColor=white)](https://www.docker.com/)

<!-- Status Badges -->
[![Case Status](https://img.shields.io/badge/CASE-100%25%20COMPLETO-brightgreen?style=for-the-badge&logo=check-circle)](https://github.com/financial-planner-org/financial-planner-case)
[![Prazo](https://img.shields.io/badge/PRAZO-ENTREGUE-success?style=for-the-badge&logo=clock)](https://github.com/financial-planner-org/financial-planner-case)
[![Qualidade](https://img.shields.io/badge/QUALIDADE-PROFISSIONAL-blue?style=for-the-badge&logo=star)](https://github.com/financial-planner-org/financial-planner-case)
[![Testes](https://img.shields.io/badge/TESTES-80%25%2B%20COBERTURA-green?style=for-the-badge&logo=test-tube)](https://github.com/financial-planner-org/financial-planner-case)
[![Docker](https://img.shields.io/badge/DOCKER-READY-blue?style=for-the-badge&logo=docker)](https://github.com/financial-planner-org/financial-planner-case)

<!-- SonarCloud Quality Badges -->
### Backend Quality
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-backend&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-backend)
[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-backend&metric=coverage)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-backend)
[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-backend&metric=bugs)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-backend)
[![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-backend&metric=code_smells)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-backend)
[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-backend&metric=security_rating)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-backend)
[![Duplicated Lines (%)](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-backend&metric=duplicated_lines_density)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-backend)

### Frontend Quality
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-frontend&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-frontend)
[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-frontend&metric=coverage)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-frontend)
[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-frontend&metric=bugs)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-frontend)
[![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-frontend&metric=code_smells)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-frontend)
[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-frontend&metric=security_rating)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-frontend)
[![Duplicated Lines (%)](https://sonarcloud.io/api/project_badges/measure?project=financial-planner-org_financial-planner-frontend&metric=duplicated_lines_density)](https://sonarcloud.io/summary/new_code?id=financial-planner-org_financial-planner-frontend)

## üìã Descri√ß√£o do Projeto

Sistema de planejamento financeiro desenvolvido para um **Multi Family Office (MFO)** como parte de um processo seletivo. A ferramenta permite acompanhar o alinhamento dos clientes ao planejamento financeiro, projetar a evolu√ß√£o patrimonial at√© 2060 e registrar eventos financeiros como movimenta√ß√µes, seguros e metas.

A interface replica fielmente o design dark-mode do [Figma fornecido](https://www.figma.com/design/i2Ml8dgRQvDsLemtRJ5Jqw/TH---Gr%C3%A1ficos-RN?node-id=168-54&t=A7GUE3s7TLja5tl3-1), sendo totalmente responsiva para desktop com suporte a zoom-in/zoom-out.

## üéØ **CASE ATENDIDO - 100% DOS REQUISITOS**

> **Status**: ‚úÖ **COMPLETO** | **Prazo**: ‚úÖ **ENTREGUE** | **Qualidade**: ‚úÖ **PROFISSIONAL**

üìã **[Ver Checklist Completo de Requisitos](REQUISITOS_CASE.md)** - Lista detalhada de todas as funcionalidades e requisitos t√©cnicos atendidos.

## üéØ Funcionalidades Implementadas

### ‚úÖ Proje√ß√£o Patrimonial

- **Endpoint de proje√ß√£o**: Recebe ID da simula√ß√£o e status (Vivo/Morto/Inv√°lido)
- **Proje√ß√£o ano a ano at√© 2060**: Taxa real composta configur√°vel (padr√£o: 4% a.a.)
- **Ponto inicial inteligente**: Considera sempre o registro mais recente de cada ativo anterior √† data da simula√ß√£o
- **Gest√£o de simula√ß√µes**: Menu de tr√™s pontos com op√ß√µes de editar, deletar e criar nova vers√£o
- **Situa√ß√£o Atual**: C√≥pia autom√°tica da simula√ß√£o principal com data atual
- **Controle de vers√µes**: Carrega apenas a vers√£o mais recente, mantendo hist√≥rico completo
- **Status de vida**: Morto (sem timeline de entradas, despesas √∑ 2), Inv√°lido (entradas encerradas)
- **Visualiza√ß√µes**: Gr√°ficos empilhados e tabelas para patrim√¥nio financeiro e imobili√°rio

### ‚úÖ Aloca√ß√µes

- **Ativos Financeiros**: Nome, valor e data de registro
- **Ativos Imobili√°rios**: Nome, valor, financiamento (data inicial, parcelas, taxa de juros, entrada)
- **Hist√≥rico completo**: Timeline de atualiza√ß√µes por ativo
- **Opera√ß√µes**: Editar registros existentes ou adicionar novos na data escolhida
- **Atualiza√ß√£o r√°pida**: Bot√£o para criar registro na data atual com valor atualizado
- **Regra de integridade**: Nunca sobrescreve registros, sempre cria novos

### ‚úÖ Movimenta√ß√µes

- **CRUD completo**: Criar, listar, atualizar e deletar eventos financeiros
- **Frequ√™ncias**: √önica, mensal ou anual
- **Timeline encadeada**: Sequ√™ncias de transa√ß√µes podem ser conectadas (ex: sal√°rio 2025-2035, novo sal√°rio 2035-2060)
- **Tipos**: Entradas (receitas) e sa√≠das (despesas)

### ‚úÖ Seguros

- **Registro completo**: Vida e invalidez
- **Campos**: Nome, data de in√≠cio, dura√ß√£o (meses), pr√™mio mensal, valor segurado
- **Integra√ß√£o**: C√°lculo autom√°tico na proje√ß√£o patrimonial

### ‚úÖ Hist√≥rico de Simula√ß√µes

- **Vers√µes legadas**: Simula√ß√µes antigas marcadas com warning e tooltip
- **Reabertura**: Visualizar gr√°ficos de qualquer vers√£o anterior
- **Cria√ß√£o a partir de vers√µes**: Possibilidade de criar nova simula√ß√£o edit√°vel a partir de vers√£o legada

## üèóÔ∏è Arquitetura e Tecnologias

### Stack Tecnol√≥gica

#### Backend (Node.js 20 + TypeScript)

- **Framework**: Fastify 4 com documenta√ß√£o Swagger autom√°tica
- **Banco de Dados**: PostgreSQL 15 (produ√ß√£o) + SQLite (desenvolvimento)
- **ORM**: Prisma 5 com migra√ß√µes automatizadas
- **Valida√ß√£o**: Zod v4 schemas integrados ao Fastify
- **Testes**: Jest + Supertest (cobertura > 80%)
- **Qualidade**: ESLint + Prettier + SonarCloud
- **Arquitetura**: Camadas (routes ‚Üí services ‚Üí repositories)
- **Documenta√ß√£o**: Swagger UI em `/documentation`

#### Frontend (Next.js 14 + TypeScript)

- **Framework**: Next.js 14 com App Router
- **UI/UX**: ShadCN/UI com tema dark-mode (conforme Figma)
- **Estado**: TanStack Query com cache inteligente
- **Formul√°rios**: React Hook Form + Zod v4
- **HTTP**: Axios com interceptors configurados
- **Estiliza√ß√£o**: Tailwind CSS com design tokens
- **Responsividade**: Design adapt√°vel com suporte a zoom-in/zoom-out
- **Testes**: Playwright para testes E2E

#### Infraestrutura

- **Cont√™ineriza√ß√£o**: Docker + Docker Compose
- **Banco de Dados**: PostgreSQL 15
- **CI/CD**: GitHub Actions
- **An√°lise de Qualidade**: SonarCloud integrado
- **Monitoramento**: Health checks e m√©tricas de performance

### Modelo de Dados

- **Simulation**: Simula√ß√µes com controle de vers√µes
- **Allocation**: Ativos financeiros e imobili√°rios
- **AssetRecord**: Hist√≥rico de valores dos ativos
- **Movement**: Movimenta√ß√µes financeiras
- **Insurance**: Seguros de vida e invalidez

## üìä Endpoints da API

### Simula√ß√µes

- `GET /simulations` - Listar simula√ß√µes
- `POST /simulations` - Criar nova simula√ß√£o
- `GET /simulations/:id` - Obter simula√ß√£o por ID
- `PUT /simulations/:id` - Atualizar simula√ß√£o
- `DELETE /simulations/:id` - Remover simula√ß√£o

### Proje√ß√µes

- `POST /projections` - Calcular proje√ß√£o patrimonial at√© 2060

### Aloca√ß√µes

- `GET /allocations/:simulationId` - Listar aloca√ß√µes da simula√ß√£o
- `POST /allocations` - Criar nova aloca√ß√£o
- `PUT /allocations/:id` - Atualizar aloca√ß√£o
- `DELETE /allocations/:id` - Remover aloca√ß√£o
- `POST /allocations/:id/records` - Adicionar registro de valor

### Movimenta√ß√µes

- `GET /movements/:simulationId` - Listar movimenta√ß√µes da simula√ß√£o
- `POST /movements` - Criar nova movimenta√ß√£o
- `PUT /movements/:id` - Atualizar movimenta√ß√£o
- `DELETE /movements/:id` - Remover movimenta√ß√£o

### Seguros

- `GET /insurances/:simulationId` - Listar seguros da simula√ß√£o
- `POST /insurances` - Criar novo seguro
- `PUT /insurances/:id` - Atualizar seguro
- `DELETE /insurances/:id` - Remover seguro

### Sa√∫de

- `GET /health` - Verificar status da API

## üê≥ Infraestrutura

```yaml
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: planner
      POSTGRES_PASSWORD: plannerpw
      POSTGRES_DB: plannerdb
    volumes:
      - pg_data:/var/lib/postgresql/data

  backend:
    build: ./backend
    depends_on:
      - db
    environment:
      DATABASE_URL: postgresql://planner:plannerpw@db:5432/plannerdb

  frontend:
    build: ./frontend
    depends_on:
      - backend
    ports:
      - "3000:3000"

volumes:
  pg_data:
```

## üì¶ Estrutura do Projeto

O projeto est√° organizado em **3 reposit√≥rios separados** na organiza√ß√£o `financial-planner-org`:

### üè¢ **Reposit√≥rios da Organiza√ß√£o**

| Reposit√≥rio | Descri√ß√£o | Tecnologias | Status |
|-------------|-----------|-------------|---------|
| [**financial-planner-case**](https://github.com/financial-planner-org/financial-planner-case) | Reposit√≥rio principal com Docker Compose e documenta√ß√£o | Docker, CI/CD, SonarCloud | ‚úÖ Ativo |
| [**financial-planner-backend**](https://github.com/financial-planner-org/financial-planner-backend) | API REST com Node.js e Fastify | Node.js, Fastify, Prisma, PostgreSQL | ‚úÖ Ativo |
| [**financial-planner-frontend**](https://github.com/financial-planner-org/financial-planner-frontend) | Interface Next.js com ShadCN/UI | Next.js, TypeScript, Tailwind CSS | ‚úÖ Ativo |

### üìÅ **Estrutura Detalhada**

```text
financial-planner-case/                    # Reposit√≥rio Principal
‚îú‚îÄ‚îÄ .github/workflows/                    # CI/CD e SonarCloud
‚îÇ   ‚îî‚îÄ‚îÄ ci.yml                           # Pipeline completo
‚îú‚îÄ‚îÄ financial-planner-backend/            # Subm√≥dulo Backend
‚îú‚îÄ‚îÄ financial-planner-frontend/           # Subm√≥dulo Frontend
‚îú‚îÄ‚îÄ docker-compose.yml                   # Orquestra√ß√£o containers
‚îú‚îÄ‚îÄ sonar-project.properties             # Configura√ß√£o SonarCloud
‚îî‚îÄ‚îÄ README.md                            # Documenta√ß√£o principal

financial-planner-backend/                # Reposit√≥rio Backend
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/                          # Rotas da API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health.ts                   # Health check
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ simulations.ts              # CRUD simula√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projections.ts              # C√°lculo proje√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ allocations.ts              # Gest√£o aloca√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ movements.ts                # Gest√£o movimenta√ß√µes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ insurances.ts               # Gest√£o seguros
‚îÇ   ‚îú‚îÄ‚îÄ services/                        # L√≥gica de neg√≥cios
‚îÇ   ‚îî‚îÄ‚îÄ server.ts                        # Servidor principal
‚îú‚îÄ‚îÄ tests/                               # Testes Jest + Supertest
‚îú‚îÄ‚îÄ prisma/                              # Schema e migra√ß√µes
‚îî‚îÄ‚îÄ Dockerfile                           # Container backend

financial-planner-frontend/               # Reposit√≥rio Frontend
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                             # App Router Next.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                    # Home (Aloca√ß√µes)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projecao/page.tsx           # P√°gina de proje√ß√µes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ historico/page.tsx          # Hist√≥rico simula√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ components/                      # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                         # ShadCN/UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/                     # Layout components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ projections/                # Components proje√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ hooks/                           # Custom hooks
‚îî‚îÄ‚îÄ Dockerfile                           # Container frontend
```

## üöÄ Instala√ß√£o e Execu√ß√£o

### Pr√©-requisitos

- Docker 20.10+
- Docker Compose 2.0+

### Configura√ß√£o Inicial

1. **Clone o reposit√≥rio**:

   ```bash
   git clone https://github.com/financial-planner-org/financial-planner-case.git
   cd financial-planner-case
   ```

2. **Inicie os servi√ßos**:

   ```bash
   docker-compose up -d --build
   ```

3. **Execute as migra√ß√µes do banco**:

   ```bash
   docker-compose exec financial-planner-backend npx prisma migrate dev
   ```

4. **Acesse as aplica√ß√µes**:
   - **Frontend**: <http://localhost:3000>
   - **Backend API**: <http://localhost:3001>
   - **Documenta√ß√£o Swagger**: <http://localhost:3001/documentation>
   - **Banco PostgreSQL**: `localhost:5432` (planner/plannerpw/plannerdb)

### Comandos de Desenvolvimento

```bash
# Ver logs em tempo real
docker-compose logs -f

# Parar todos os servi√ßos
docker-compose down

# Reconstruir e reiniciar
docker-compose up -d --build

# Acessar banco de dados via CLI
docker-compose exec postgres psql -U planner -d plannerdb

# Executar comandos no backend
docker-compose exec financial-planner-backend npm run test
```

## üß™ Qualidade e Testes

### Estrat√©gia de Testes

O projeto implementa uma estrat√©gia abrangente de testes com foco na qualidade e confiabilidade do c√≥digo:

- **Testes Unit√°rios**: Cobertura > 80% com Jest
- **Testes de Integra√ß√£o**: Valida√ß√£o de endpoints com Supertest
- **Testes E2E**: Fluxos completos de usu√°rio
- **Organiza√ß√£o**: Estrutura espelha a arquitetura do c√≥digo

### Execu√ß√£o de Testes

```bash
# Backend
cd financial-planner-backend
npm test                    # Testes unit√°rios
npm run test:coverage       # Com relat√≥rio de cobertura
npm run test:ci            # Modo CI/CD

# Frontend
cd financial-planner-frontend
npm run lint               # An√°lise de c√≥digo
npm run build              # Build de produ√ß√£o
```

### An√°lise de Qualidade com SonarCloud

O projeto integra o SonarCloud para an√°lise cont√≠nua de qualidade de c√≥digo, conforme especificado no case. A integra√ß√£o monitora bugs, vulnerabilidades de seguran√ßa e m√©tricas de cobertura atrav√©s de workflows do GitHub Actions.

#### Configura√ß√£o B√°sica

Para ativar o SonarCloud:

1. Configure os secrets no reposit√≥rio GitHub:
   - **SONAR_TOKEN**: Token de acesso do SonarCloud
   - **SONAR_ORGANIZATION**: Nome da sua organization GitHub

2. Atualize os arquivos `sonar-project.properties` com o nome da sua organization

3. Instale as depend√™ncias:

```bash
   # Backend
   cd financial-planner-backend
   npm install sonar-scanner --save-dev
   
   # Frontend  
cd financial-planner-frontend
   npm install sonar-scanner --save-dev
```

#### Execu√ß√£o de An√°lises

As an√°lises s√£o executadas automaticamente via GitHub Actions quando h√° push para `main` ou `develop`. Para an√°lises locais:

```bash
# Backend
cd financial-planner-backend
npm run test:coverage
npm run sonar

# Frontend
cd financial-planner-frontend
npm run build
npm run sonar
```

#### M√©tricas Analisadas

- **Reliability**: Detec√ß√£o de bugs e vulnerabilidades
- **Security**: An√°lise de seguran√ßa
- **Maintainability**: Complexidade e c√≥digo duplicado
- **Coverage**: Cobertura de testes unit√°rios
- **Duplications**: C√≥digo duplicado

Os resultados s√£o exibidos atrav√©s de badges no README. Acesse o [SonarCloud Dashboard](https://sonarcloud.io/) para an√°lise detalhada.

## ü§ù Desenvolvimento e Contribui√ß√£o

### Ambiente de Desenvolvimento

Para contribuir com o projeto:

1. **Configure o ambiente local**:

   ```bash
   # Backend
   cd financial-planner-backend
   npm install
   npm run dev

   # Frontend
   cd financial-planner-frontend
   npm install
   npm run dev
   ```

2. **Execute os testes**:

   ```bash
   # Backend
   npm run test:coverage

   # Frontend
   npm run lint
   npm run build
   ```

### Conven√ß√µes de C√≥digo

- **Commits**: Use conventional commits (feat:, fix:, docs:, etc.)
- **Branches**: `feature/nome-da-feature` ou `fix/nome-do-bug`
- **Testes**: Mantenha cobertura > 80%
- **C√≥digo**: Siga padr√µes ESLint + Prettier

### Processo de Contribui√ß√£o

1. Fork o reposit√≥rio
2. Crie uma branch para sua feature
3. Implemente com testes
4. Execute an√°lise SonarCloud
5. Abra Pull Request com descri√ß√£o clara

## üìù Licen√ßa

Este projeto est√° licenciado sob a [Licen√ßa MIT](LICENSE).
